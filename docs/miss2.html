<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 More Missing Data | The Data Analyst’s Guide to Cause and Effect</title>
  <meta name="description" content="The is the companion website for The Data Analyst’s Guide to Cause and Effect" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 More Missing Data | The Data Analyst’s Guide to Cause and Effect" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The is the companion website for The Data Analyst’s Guide to Cause and Effect" />
  <meta name="github-repo" content="tbendixen/DAG-companion" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 More Missing Data | The Data Analyst’s Guide to Cause and Effect" />
  
  <meta name="twitter:description" content="The is the companion website for The Data Analyst’s Guide to Cause and Effect" />
  

<meta name="author" content="Theiss Bendixen &amp; Benjamin Grant Purzycki" />


<meta name="date" content="2024-10-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="miss.html"/>
<link rel="next" href="advest.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The Data Analyst's Guide to Cause and Effect</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="dag.html"><a href="dag.html"><i class="fa fa-check"></i><b>2</b> Causal Graphs</a>
<ul>
<li class="chapter" data-level="2.1" data-path="dag.html"><a href="dag.html#the-fork"><i class="fa fa-check"></i><b>2.1</b> The Fork</a></li>
<li class="chapter" data-level="2.2" data-path="dag.html"><a href="dag.html#the-pipe"><i class="fa fa-check"></i><b>2.2</b> The Pipe</a></li>
<li class="chapter" data-level="2.3" data-path="dag.html"><a href="dag.html#the-collider"><i class="fa fa-check"></i><b>2.3</b> The Collider</a></li>
<li class="chapter" data-level="2.4" data-path="dag.html"><a href="dag.html#post-treatment-bias"><i class="fa fa-check"></i><b>2.4</b> Post-treatment bias</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="gmethods.html"><a href="gmethods.html"><i class="fa fa-check"></i><b>3</b> G-methods and Marginal Effects</a>
<ul>
<li class="chapter" data-level="3.1" data-path="gmethods.html"><a href="gmethods.html#inverse-probability-weighting"><i class="fa fa-check"></i><b>3.1</b> Inverse probability weighting</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="gmethods.html"><a href="gmethods.html#bootstrapping"><i class="fa fa-check"></i><b>3.1.1</b> Bootstrapping</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="gmethods.html"><a href="gmethods.html#g-computation"><i class="fa fa-check"></i><b>3.2</b> G-computation</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="gmethods.html"><a href="gmethods.html#bootstrapping-1"><i class="fa fa-check"></i><b>3.2.1</b> Bootstrapping</a></li>
<li class="chapter" data-level="3.2.2" data-path="gmethods.html"><a href="gmethods.html#bayesian-g-computation"><i class="fa fa-check"></i><b>3.2.2</b> Bayesian g-computation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="gmethods2.html"><a href="gmethods2.html"><i class="fa fa-check"></i><b>4</b> Adventures in G-methods</a>
<ul>
<li class="chapter" data-level="4.1" data-path="gmethods2.html"><a href="gmethods2.html#doubly-robust-estimation"><i class="fa fa-check"></i><b>4.1</b> Doubly robust estimation</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="gmethods2.html"><a href="gmethods2.html#bootstrapping-2"><i class="fa fa-check"></i><b>4.1.1</b> Bootstrapping</a></li>
<li class="chapter" data-level="4.1.2" data-path="gmethods2.html"><a href="gmethods2.html#more-covariates"><i class="fa fa-check"></i><b>4.1.2</b> More covariates</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="gmethods2.html"><a href="gmethods2.html#bootstrapped-sub-group-analysis"><i class="fa fa-check"></i><b>4.2</b> Bootstrapped sub-group analysis</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="miss.html"><a href="miss.html"><i class="fa fa-check"></i><b>5</b> Most of Your Data is Almost Always Missing</a>
<ul>
<li class="chapter" data-level="5.1" data-path="miss.html"><a href="miss.html#simulating-missingness"><i class="fa fa-check"></i><b>5.1</b> Simulating missingness</a></li>
<li class="chapter" data-level="5.2" data-path="miss.html"><a href="miss.html#poststratification"><i class="fa fa-check"></i><b>5.2</b> Poststratification</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="miss.html"><a href="miss.html#frequentist-poststratification"><i class="fa fa-check"></i><b>5.2.1</b> Frequentist poststratification</a></li>
<li class="chapter" data-level="5.2.2" data-path="miss.html"><a href="miss.html#bayesian-poststratification"><i class="fa fa-check"></i><b>5.2.2</b> Bayesian poststratification</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="miss.html"><a href="miss.html#instrumental-variable-analysis"><i class="fa fa-check"></i><b>5.3</b> Instrumental variable analysis</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="miss.html"><a href="miss.html#preparing-cohen-et-al.-2015"><i class="fa fa-check"></i><b>5.3.1</b> Preparing Cohen et al. (2015)</a></li>
<li class="chapter" data-level="5.3.2" data-path="miss.html"><a href="miss.html#randomized-treatment-assignment-as-instrument"><i class="fa fa-check"></i><b>5.3.2</b> Randomized treatment assignment as instrument</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="miss.html"><a href="miss.html#bayesian-instrumental-variable-analysis"><i class="fa fa-check"></i><b>5.4</b> Bayesian instrumental variable analysis</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="miss2.html"><a href="miss2.html"><i class="fa fa-check"></i><b>6</b> More Missing Data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="miss2.html"><a href="miss2.html#simple-mean-imputation-vs.-multiple-imputation"><i class="fa fa-check"></i><b>6.1</b> Simple mean imputation vs. multiple imputation</a></li>
<li class="chapter" data-level="6.2" data-path="miss2.html"><a href="miss2.html#combine-then-predict-or-predict-then-combine"><i class="fa fa-check"></i><b>6.2</b> “Combine then predict” or “predict then combine”?</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="miss2.html"><a href="miss2.html#marginaleffects"><i class="fa fa-check"></i><b>6.2.1</b> <code>marginaleffects</code></a></li>
<li class="chapter" data-level="6.2.2" data-path="miss2.html"><a href="miss2.html#emmeans"><i class="fa fa-check"></i><b>6.2.2</b> <code>emmeans</code></a></li>
<li class="chapter" data-level="6.2.3" data-path="miss2.html"><a href="miss2.html#comparison"><i class="fa fa-check"></i><b>6.2.3</b> Comparison</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="miss2.html"><a href="miss2.html#bayesian-imputation"><i class="fa fa-check"></i><b>6.3</b> Bayesian imputation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="advest.html"><a href="advest.html"><i class="fa fa-check"></i><b>7</b> Advanced Estimation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="advest.html"><a href="advest.html#multilevel-malaria-medicine"><i class="fa fa-check"></i><b>7.1</b> Multilevel malaria medicine</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="advest.html"><a href="advest.html#naïve-model-simple-intercept-and-slope"><i class="fa fa-check"></i><b>7.1.1</b> Naïve model: Simple intercept and slope</a></li>
<li class="chapter" data-level="7.1.2" data-path="advest.html"><a href="advest.html#fixed-effects"><i class="fa fa-check"></i><b>7.1.2</b> Fixed effects</a></li>
<li class="chapter" data-level="7.1.3" data-path="advest.html"><a href="advest.html#fixed-effects-interacting-treatment-and-group"><i class="fa fa-check"></i><b>7.1.3</b> Fixed effects interacting treatment and group</a></li>
<li class="chapter" data-level="7.1.4" data-path="advest.html"><a href="advest.html#random-intercepts"><i class="fa fa-check"></i><b>7.1.4</b> Random intercepts</a></li>
<li class="chapter" data-level="7.1.5" data-path="advest.html"><a href="advest.html#random-intercepts-and-slopes"><i class="fa fa-check"></i><b>7.1.5</b> Random intercepts and slopes</a></li>
<li class="chapter" data-level="7.1.6" data-path="advest.html"><a href="advest.html#plot-models-in-a-panel"><i class="fa fa-check"></i><b>7.1.6</b> Plot models in a panel</a></li>
<li class="chapter" data-level="7.1.7" data-path="advest.html"><a href="advest.html#regularized-vs.-empirical-estimates"><i class="fa fa-check"></i><b>7.1.7</b> Regularized vs. empirical estimates</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="advest.html"><a href="advest.html#simulating-mundlak"><i class="fa fa-check"></i><b>7.2</b> Simulating Mundlak</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="advest.html"><a href="advest.html#naïve-model-ignoring-group"><i class="fa fa-check"></i><b>7.2.1</b> Naïve model (ignoring group)</a></li>
<li class="chapter" data-level="7.2.2" data-path="advest.html"><a href="advest.html#fixed-effects-1"><i class="fa fa-check"></i><b>7.2.2</b> Fixed effects</a></li>
<li class="chapter" data-level="7.2.3" data-path="advest.html"><a href="advest.html#random-intercepts-1"><i class="fa fa-check"></i><b>7.2.3</b> Random intercepts</a></li>
<li class="chapter" data-level="7.2.4" data-path="advest.html"><a href="advest.html#mundlak-model"><i class="fa fa-check"></i><b>7.2.4</b> Mundlak model</a></li>
<li class="chapter" data-level="7.2.5" data-path="advest.html"><a href="advest.html#plot-effect-estimate-distributions"><i class="fa fa-check"></i><b>7.2.5</b> Plot effect estimate distributions</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="advest.html"><a href="advest.html#education-and-prosociality-mundlak-in-action"><i class="fa fa-check"></i><b>7.3</b> Education and prosociality: Mundlak in action</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="advest.html"><a href="advest.html#raw-data-distributions"><i class="fa fa-check"></i><b>7.3.1</b> Raw data distributions</a></li>
<li class="chapter" data-level="7.3.2" data-path="advest.html"><a href="advest.html#naïve-model"><i class="fa fa-check"></i><b>7.3.2</b> Naïve model</a></li>
<li class="chapter" data-level="7.3.3" data-path="advest.html"><a href="advest.html#fixed-effects-2"><i class="fa fa-check"></i><b>7.3.3</b> Fixed effects</a></li>
<li class="chapter" data-level="7.3.4" data-path="advest.html"><a href="advest.html#random-effects"><i class="fa fa-check"></i><b>7.3.4</b> Random effects</a></li>
<li class="chapter" data-level="7.3.5" data-path="advest.html"><a href="advest.html#mundlak-model-1"><i class="fa fa-check"></i><b>7.3.5</b> Mundlak model</a></li>
<li class="chapter" data-level="7.3.6" data-path="advest.html"><a href="advest.html#plotting-effect-of-education-on-religiosity"><i class="fa fa-check"></i><b>7.3.6</b> Plotting effect of education on religiosity</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="advest.html"><a href="advest.html#marginal-effects-in-a-multilevel-model"><i class="fa fa-check"></i><b>7.4</b> Marginal effects in a multilevel model</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="advest.html"><a href="advest.html#frequentist-workflow"><i class="fa fa-check"></i><b>7.4.1</b> Frequentist workflow</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>The Data Analyst’s Guide to Cause and Effect</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="miss2" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> More Missing Data<a href="miss2.html#miss2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="simple-mean-imputation-vs.-multiple-imputation" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Simple mean imputation vs. multiple imputation<a href="miss2.html#simple-mean-imputation-vs.-multiple-imputation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here we illustrate simple mean imputation.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="miss2.html#cb84-1" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/cohen2015miss.csv&quot;</span>)</span>
<span id="cb84-2"><a href="miss2.html#cb84-2" tabindex="-1"></a></span>
<span id="cb84-3"><a href="miss2.html#cb84-3" tabindex="-1"></a>d<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">scale</span>(d<span class="sc">$</span>age) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb84-4"><a href="miss2.html#cb84-4" tabindex="-1"></a>d_mimp <span class="ot">&lt;-</span> d</span>
<span id="cb84-5"><a href="miss2.html#cb84-5" tabindex="-1"></a>d_mimp<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">with</span>(d_mimp,</span>
<span id="cb84-6"><a href="miss2.html#cb84-6" tabindex="-1"></a>                   <span class="fu">ifelse</span>(<span class="fu">is.na</span>(age),</span>
<span id="cb84-7"><a href="miss2.html#cb84-7" tabindex="-1"></a>                          <span class="fu">mean</span>(age, <span class="at">na.rm =</span> T),</span>
<span id="cb84-8"><a href="miss2.html#cb84-8" tabindex="-1"></a>                          age))</span>
<span id="cb84-9"><a href="miss2.html#cb84-9" tabindex="-1"></a></span>
<span id="cb84-10"><a href="miss2.html#cb84-10" tabindex="-1"></a><span class="fu">lm</span>(act <span class="sc">~</span> subsidy <span class="sc">+</span> age, <span class="at">data =</span> d_mimp) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = act ~ subsidy + age, data = d_mimp)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.4774 -0.3866 -0.2396  0.5566  0.9431 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.19126    0.03555   5.380 1.05e-07 ***
## subsidy      0.19535    0.04151   4.706 3.11e-06 ***
## age         -0.06592    0.01892  -3.485 0.000527 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4608 on 628 degrees of freedom
##   (34 observations deleted due to missingness)
## Multiple R-squared:  0.05275,    Adjusted R-squared:  0.04973 
## F-statistic: 17.49 on 2 and 628 DF,  p-value: 4.074e-08</code></pre>
<p>We can compare with a complete-case analysis…</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="miss2.html#cb86-1" tabindex="-1"></a><span class="fu">lm</span>(act <span class="sc">~</span> subsidy <span class="sc">+</span> age, <span class="at">data =</span> d) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = act ~ subsidy + age, data = d)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.4908 -0.3978 -0.2439  0.5472  0.9378 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.19579    0.03679   5.321 1.46e-07 ***
## subsidy      0.20467    0.04291   4.769 2.33e-06 ***
## age         -0.06558    0.01905  -3.443 0.000615 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.464 on 598 degrees of freedom
##   (64 observations deleted due to missingness)
## Multiple R-squared:  0.05574,    Adjusted R-squared:  0.05258 
## F-statistic: 17.65 on 2 and 598 DF,  p-value: 3.565e-08</code></pre>
<p>… As well as multiple imputation.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="miss2.html#cb88-1" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb88-2"><a href="miss2.html#cb88-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb88-3"><a href="miss2.html#cb88-3" tabindex="-1"></a></span>
<span id="cb88-4"><a href="miss2.html#cb88-4" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(d)</span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="miss2.html#cb89-1" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">with</span>(imp, <span class="fu">lm</span>(act <span class="sc">~</span> subsidy <span class="sc">+</span> age))</span>
<span id="cb89-2"><a href="miss2.html#cb89-2" tabindex="-1"></a></span>
<span id="cb89-3"><a href="miss2.html#cb89-3" tabindex="-1"></a><span class="fu">pool</span>(fit) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##          term    estimate  std.error statistic       df      p.value
## 1 (Intercept)  0.18965550 0.03496624  5.423960 550.9040 8.739647e-08
## 2     subsidy  0.19910361 0.04072650  4.888798 580.3649 1.314949e-06
## 3         age -0.06753163 0.01892160 -3.569022 153.9652 4.781627e-04</code></pre>
<p>In all cases, the point estimate for both the intercept and effect of subsidy is around 0.20.</p>
</div>
<div id="combine-then-predict-or-predict-then-combine" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> “Combine then predict” or “predict then combine”?<a href="miss2.html#combine-then-predict-or-predict-then-combine" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the main text we say that we have a choice to make when working with a model fitted on multiply imputed data: Do we apply Rubin’s pooling rules on the model coefficients or on model predictions? We can refer to these different approaches as “combine then predict” and “predict then combine,” respectively, following Miles [REF].</p>
<p>Since different <code>R</code> packages implement post-processing of multiply imputed model fits differently, we show a basic implementations here with two popular <code>R</code> packages. What the packages have in common is that they allow us to conveniently work with the <code>mice</code> object as we would any other model fit. Let’s proceed with the malaria subsidy data and imagine we want an average treatment effect of the subsidy treatment of ACT uptake marginal of age using g-computation.</p>
<div id="marginaleffects" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> <code>marginaleffects</code><a href="miss2.html#marginaleffects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>marginaleffects</code> package [REF] implements “predict then combine”; that is, it obtains model predictions for each of the <em>m</em> data sets and then apply Rubin’s rules to the predictions to pool them. G-computation is very straightforward to implement.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="miss2.html#cb91-1" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb91-2"><a href="miss2.html#cb91-2" tabindex="-1"></a></span>
<span id="cb91-3"><a href="miss2.html#cb91-3" tabindex="-1"></a><span class="fu">avg_comparisons</span>(fit, <span class="at">variables =</span> <span class="fu">list</span>(<span class="at">subsidy =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## 
##     Term          Contrast Estimate Std. Error    t Pr(&gt;|t|)    S 2.5 % 97.5 %
##  subsidy mean(1) - mean(0)    0.199     0.0407 4.89   &lt;0.001 19.9 0.119  0.279
##    Df
##  5965
## 
## Columns: term, contrast, estimate, std.error, s.value, predicted_lo, predicted_hi, predicted, df, statistic, p.value, conf.low, conf.high 
## Type:  response</code></pre>
</div>
<div id="emmeans" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> <code>emmeans</code><a href="miss2.html#emmeans" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>On the other hand, the <code>emmeans</code> package [REF] implements “combine then predict”; that is, it applies Rubin’s rules to the model coefficients to pool them and only then obtain model predictions. A basic g-computation implementation could like this using <code>emmeans</code>.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="miss2.html#cb93-1" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb93-2"><a href="miss2.html#cb93-2" tabindex="-1"></a></span>
<span id="cb93-3"><a href="miss2.html#cb93-3" tabindex="-1"></a><span class="fu">emmeans</span>(<span class="at">specs =</span> <span class="st">&quot;subsidy&quot;</span>, </span>
<span id="cb93-4"><a href="miss2.html#cb93-4" tabindex="-1"></a>        <span class="fu">ref_grid</span>(fit)) <span class="sc">|&gt;</span></span>
<span id="cb93-5"><a href="miss2.html#cb93-5" tabindex="-1"></a>  <span class="fu">contrast</span>(<span class="st">&quot;revpairwise&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb93-6"><a href="miss2.html#cb93-6" tabindex="-1"></a>  <span class="fu">confint</span>()</span></code></pre></div>
<pre><code>##  contrast            estimate     SE  df lower.CL upper.CL
##  subsidy1 - subsidy0    0.199 0.0407 580    0.119    0.279
## 
## Confidence level used: 0.95</code></pre>
<p>We see that results are identical to those obtained with <code>marginaleffects</code>.</p>
</div>
<div id="comparison" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Comparison<a href="miss2.html#comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>But let’s try to see when the two different approaches give different results. Instead of a linear model on the imputed datasets, we instead use a non-linear model in the form of a logistic regression. We do this by calling <code>glm()</code> instead of <code>lm()</code> and setting <code>family = "binomial"</code>.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="miss2.html#cb95-1" tabindex="-1"></a>fit_binom <span class="ot">&lt;-</span> <span class="fu">with</span>(imp, <span class="fu">glm</span>(act <span class="sc">~</span> subsidy <span class="sc">+</span> age, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>))</span></code></pre></div>
<p>Then, we apply our two approaches. The <code>marginaleffects</code> implementation is identical to above even though the model fit is now a logistic regression.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="miss2.html#cb96-1" tabindex="-1"></a><span class="fu">avg_comparisons</span>(fit_binom, <span class="at">variables =</span> <span class="fu">list</span>(<span class="at">subsidy =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## 
##     Term          Contrast Estimate Std. Error    t Pr(&gt;|t|)    S 2.5 % 97.5 %
##  subsidy mean(1) - mean(0)    0.201     0.0369 5.44   &lt;0.001 24.1 0.128  0.273
##    Df
##  3541
## 
## Columns: term, contrast, estimate, std.error, s.value, predicted_lo, predicted_hi, predicted, df, statistic, p.value, conf.low, conf.high 
## Type:  response</code></pre>
<p>For the <code>emmeans</code> approach, to get predictions on the probability scale, we can wrap the <code>ref_grid()</code> function in <code>regrid()</code> and set <code>type = "response"</code>. We see that results are very similar but not identical.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="miss2.html#cb98-1" tabindex="-1"></a><span class="fu">emmeans</span>(<span class="at">specs =</span> <span class="st">&quot;subsidy&quot;</span>,</span>
<span id="cb98-2"><a href="miss2.html#cb98-2" tabindex="-1"></a>        <span class="fu">regrid</span>(<span class="fu">ref_grid</span>(fit_binom),</span>
<span id="cb98-3"><a href="miss2.html#cb98-3" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb98-4"><a href="miss2.html#cb98-4" tabindex="-1"></a>  <span class="fu">contrast</span>(<span class="st">&quot;revpairwise&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb98-5"><a href="miss2.html#cb98-5" tabindex="-1"></a>  <span class="fu">confint</span>()</span></code></pre></div>
<pre><code>##  contrast            estimate    SE   df lower.CL upper.CL
##  subsidy1 - subsidy0    0.203 0.037 1566     0.13    0.275
## 
## Confidence level used: 0.95</code></pre>
</div>
</div>
<div id="bayesian-imputation" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Bayesian imputation<a href="miss2.html#bayesian-imputation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the book, we also mentioned an alternative imputation approach, namely Bayesian imputation. Using the <code>brms</code> [REF] package, we’ll show a very basic implementation. The syntax should seem somewhat familiar, as <code>brms</code> uses common <code>R</code> regression syntax. Note that <code>brms</code> requires the <code>Rstan</code> package [REF] or the <code>cmdstanr</code> [REF] package.</p>
<p>First, we define the model formula. At its core, it’s similar to the <code>lm()</code> formula above, except for a few complications. The formula object holds two main components, each wrapped by <code>bf()</code>. In the first part, we indicate the covariate we want to impute – in the case, <code>age</code> – with the <code>mi()</code> wrapper. The second part specifies a model for the variable we want to impute. Finally, we feed that formula to <code>brm()</code> along with the data. We then set the cores to 4 for speedier sampling and a seed for numeric reproducibility. We strongly recommend McElreath (and Kurz’ translations) [REF] for more details and a general introduction ot Bayesian inference more generally.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="miss2.html#cb100-1" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="miss2.html#cb101-1" tabindex="-1"></a><span class="co"># Define model formula</span></span>
<span id="cb101-2"><a href="miss2.html#cb101-2" tabindex="-1"></a>formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(act <span class="sc">~</span> subsidy <span class="sc">+</span> <span class="fu">mi</span>(age)) <span class="sc">+</span></span>
<span id="cb101-3"><a href="miss2.html#cb101-3" tabindex="-1"></a>           <span class="fu">bf</span>(age <span class="sc">|</span> <span class="fu">mi</span>() <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb101-4"><a href="miss2.html#cb101-4" tabindex="-1"></a></span>
<span id="cb101-5"><a href="miss2.html#cb101-5" tabindex="-1"></a><span class="co"># Fit model to data</span></span>
<span id="cb101-6"><a href="miss2.html#cb101-6" tabindex="-1"></a>bfit <span class="ot">&lt;-</span> <span class="fu">brm</span>(formula,</span>
<span id="cb101-7"><a href="miss2.html#cb101-7" tabindex="-1"></a>            <span class="at">data =</span> d,</span>
<span id="cb101-8"><a href="miss2.html#cb101-8" tabindex="-1"></a>            <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">2020</span>,</span>
<span id="cb101-9"><a href="miss2.html#cb101-9" tabindex="-1"></a>            <span class="at">file =</span> <span class="st">&quot;fits/bfit.rds&quot;</span>)</span></code></pre></div>
<p>We can get a summary of the Bayesian model by calling <code>summary()</code></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="miss2.html#cb102-1" tabindex="-1"></a><span class="fu">summary</span>(bfit)</span></code></pre></div>
<pre><code>##  Family: MV(gaussian, gaussian) 
##   Links: mu = identity; sigma = identity
##          mu = identity; sigma = identity 
## Formula: act ~ subsidy + mi(age) 
##          age | mi() ~ 1 
##    Data: d (Number of observations: 631) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Regression Coefficients:
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## act_Intercept     0.19      0.04     0.12     0.26 1.00     8466     2986
## age_Intercept    -0.02      0.04    -0.10     0.06 1.00     6946     3032
## act_subsidy       0.20      0.04     0.12     0.28 1.00     7634     2840
## act_miage        -0.06      0.02    -0.10    -0.03 1.00     9493     2986
## 
## Further Distributional Parameters:
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma_act     0.46      0.01     0.44     0.49 1.00     8351     3073
## sigma_age     1.00      0.03     0.94     1.06 1.00     6670     2543
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The coefficient <code>act_subsidy</code> corresponds to the <code>subsidy</code> coefficient in the <code>lm()</code> and <code>glm()</code> calls above. We see that the coefficients are very similar to the models above, except now we also have coefficients for the model predicting age (the <code>age_</code> parameters).</p>
<p>Now, there are many ways to extend this model, which are outside the scope of this companion website, for instance using more informative prior settings, constraining imputed values to be within realistic ranges, include covariates in the sub-model predicting missing <code>age</code> values, or use a different likelihood for <code>act</code> that respects its binary nature (e.g., a logistic regression model).</p>
<p>We can also inspect the distribution of imputed values. For instance, we can plot 20 draws from the distribution of the imputed age variable (light blue curves) against the observed distribution of age in the sample (dark blue curve)…</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="miss2.html#cb104-1" tabindex="-1"></a><span class="fu">pp_check</span>(bfit, <span class="at">resp =</span> <span class="st">&quot;age&quot;</span>, <span class="at">ndraws =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="bookdown-dag_files/figure-html/ch6-fig-unnamed-chunk-80-1.png" width="480" /></p>
<p>… Which is somewhat similar to this plot of imputed data sets (red curves) against the observed (blue curve) from the <code>mice</code> implementation shown in the text.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="miss2.html#cb105-1" tabindex="-1"></a><span class="fu">densityplot</span>(imp, <span class="sc">~</span> age)</span></code></pre></div>
<p><img src="bookdown-dag_files/figure-html/ch6-fig-unnamed-chunk-81-1.png" width="480" /></p>
<p>Now, we can post-process the Bayesian model fit exactly as shown in Chapters 3 and 5 [REF] using the <code>tidybayes</code>-based workflow [REF]. Or, we can use <code>marginaleffects</code> just as shown for the <code>mice</code> object above, except we need to specify that it’s the model predicting ACT uptake that we want to apply g-computation to; this is what <code>resp = "act"</code> does.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="miss2.html#cb106-1" tabindex="-1"></a><span class="fu">avg_comparisons</span>(bfit, <span class="at">variables =</span> <span class="fu">list</span>(<span class="at">subsidy =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>), <span class="at">resp =</span> <span class="st">&quot;act&quot;</span>)</span></code></pre></div>
<pre><code>## 
##     Term          Contrast Estimate 2.5 % 97.5 %
##  subsidy mean(1) - mean(0)    0.195 0.116  0.276
## 
## Columns: term, contrast, estimate, conf.low, conf.high, predicted_lo, predicted_hi, predicted, tmp_idx 
## Type:  response</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="miss.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="advest.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
